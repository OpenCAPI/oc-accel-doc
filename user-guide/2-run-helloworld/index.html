<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>(2) Run helloworld - OC-Accel Doc</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">OC-Accel Doc</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../..">Overview</a>
</li>
                                    
<li >
    <a href="../../repository/">About the repository</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../0-steps/">(0) Steps in a glance</a>
</li>
                                    
<li >
    <a href="../1-prepare-env/">(1) Prepare environment</a>
</li>
                                    
<li class="active">
    <a href="./">(2) Run helloworld</a>
</li>
                                    
<li >
    <a href="../3-new-action/">(3) Create a new action</a>
</li>
                                    
<li >
    <a href="../4-hdl-design/">(4) Verilog/VHDL design</a>
</li>
                                    
<li >
    <a href="../5-hls-design/">(5) HLS C++ design</a>
</li>
                                    
<li >
    <a href="../6-co-simulation/">(6) Co-Simulation</a>
</li>
                                    
<li >
    <a href="../7-build-image/">(7) Build image</a>
</li>
                                    
<li >
    <a href="../8-deploy/">(8) Deploy on Power Server</a>
</li>
                                    
<li >
    <a href="../9-migrate/">(9) Migrate from SNAP1/2</a>
</li>
                                    
<li >
    <a href="../10-tips/">(10) Tips</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../actions-doc/hdl_example/">hdl_example</a>
</li>
                                    
<li >
    <a href="../../actions-doc/hdl_single_engine/">hdl_single_engine</a>
</li>
                                    
<li >
    <a href="../../actions-doc/hls_helloworld/">hls_helloworld</a>
</li>
                                    
<li >
    <a href="../../actions-doc/hls_memcopy_1024/">hls_memcopy_1024</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Deep Dive <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../deep-dive/software-api/">Software API</a>
</li>
                                    
<li >
    <a href="../../deep-dive/registers/">Registers</a>
</li>
                                    
<li >
    <a href="../../deep-dive/hardware-logic/">Hardware Logic</a>
</li>
                                    
<li >
    <a href="../../deep-dive/board-package/">New Board Support</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../misc/doc-guide/">Document Guide</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../1-prepare-env/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../3-new-action/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/OpenCAPI/oc-accel"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#run-hls_helloworld">Run hls_helloworld</a></li>
            <li><a href="#snap_config">snap_config</a></li>
            <li><a href="#simulation">Simulation</a></li>
            <li><a href="#make-fpga-bit-image">Make FPGA bit image</a></li>
            <li><a href="#summary">Summary</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="run-hls_helloworld">Run hls_helloworld</h1>
<h2 id="snap_config">snap_config</h2>
<pre><code>cd oc-accel
./ocaccel_workflow.py
</code></pre>

<p>Then a KConfig window will popped up. If it doesn't, check <a href="../../#required-tools-for-development">Required tools</a> and search 'kconfig' on the homepage.</p>
<p><img alt="snap-config-blue" src="../pictures/2-snap-config-blue.png" /></p>
<p>Select HLS HelloWorld in "Action Type".</p>
<p><img alt="select-helloworld" src="../pictures/2-select-helloworld.png" /></p>
<p>There are some other choices listed in the menu. Please input <code>OCSE_ROOT</code> path. Select <code>xsim</code> (the default simulator).</p>
<p>To select a TRUE/FALSE feature, press "Y" or "N". After everything done, move cursor to "Exit".</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This Kconfig menu is editable. If you want to add new features or enrich your own menu, please edit <code>scripts/Kconfig</code> file.</p>
</div>
<p>Then it starts to execute many steps to build a simulation model. It needs several minutes. While waiting for it, open another terminal tab and try to get familiar with some environmental variables. Open <code>snap_env.sh</code> and check the very basic ones:</p>
<pre><code class="bash">export ACTION_ROOT=&lt;path_of_oc-accel&gt;/actions/hls_helloworld
export TIMING_LABLIMIT=&quot;-200&quot;
export OCSE_ROOT=&lt;path_to_ocse&gt;/ocse
</code></pre>

<h2 id="simulation">Simulation</h2>
<p><strong>ocaccel-workflow.py</strong> continues running and prints:</p>
<pre><code>SNAP Configured
You've got configuration like:
    ACTION_ROOT /afs/vlsilab.boeblingen.ibm.com/data/vlsi/eclipz/c14/usr/luyong/p9nd2/oc_dev/oc-accel/actions/hls_helloworld
    FPGACARD    AD9V3
    FPGACHIP    xcvu3p-ffvc1517-2-e
    SIMULATOR   xsim
    CAPI_VER    opencapi30
    OCSE_ROOT   ../ocse
--------&gt; Environment Check
vivado   installed as   /afs/bb/proj/fpga/xilinx/Vivado/2018.3/bin/vivado
gcc  installed as   /bin/gcc
xterm    installed as   /bin/xterm
OCSE path /afs/vlsilab.boeblingen.ibm.com/data/vlsi/eclipz/c14/usr/luyong/p9nd2/oc_dev/ocse is valid
SNAP ROOT /afs/vlsilab.boeblingen.ibm.com/data/vlsi/eclipz/c14/usr/luyong/p9nd2/oc_dev/oc-accel is valid
Environment check PASSED
--------&gt; Make the simulation model
Runnig ... check ./snap_workflow.make_model.log for details of full progress
[CREATE_SNAP_IPs.....] start - [===========                  ] 37%

</code></pre>

<p>Then a Xterm window will popped up. (If it doesn't, check if you have installed it by typing <code>xterm</code> in your terminal.)
<img alt="xterm-window" src="../pictures/2-xterm-window.png" /></p>
<p>This Xterm window is where you run your application (software part). You can run anything as many times as you want in the xterm window, just like running in the terminal of a real server with FPGA card plugged.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you want to save the content running in this xterm window, please use <code>script</code> before running any commands. When you exit xterm window, everything is saved to a file -- "typescript" is its default name.</p>
</div>
<pre><code>$ script
Script started, file is typescript
...... Run Anything .....
$ exit
exit
Script done, file is typescript
</code></pre>

<p>Now let's run application <strong>snap_helloworld</strong>. It is located in <code>$ACTION_ROOT/sw</code>, where $ACTION_ROOT is <code>&lt;path_of_oc-accel&gt;/actions/hls_helloworld</code>. In the above window, it prints the help messages because it requires two arguments: an input text file and an output text file.</p>
<p>We have prepared a script in <code>$ACTION_ROOT/tests/hw_test.sh</code> and you can run it directly.</p>
<p>This example is asking FPGA to read the input file from host memory, converting the letters to capital case, and write them back to host memory and save in the output file.</p>
<p><img alt="hw-test" src="../pictures/2-hw-test.png" /></p>
<p>Now you have finished the software/hardware co-simulation.</p>
<p>Type 'exit' in xterm window.</p>
<p>All the output logs, waveforms are in <code>hardware/sim/&lt;simulator&gt;/latest</code>.</p>
<pre><code>hdclf154: luyong /afs/bb/u/luyong/p9/nd2/oc_dev/oc-accel/hardware/sim/xsim/latest $ ls
debug.log   ocse_server.dat  snap_helloworld.log  tin      webtalk.jou  xsim.dir  xsrun.tcl
ocse.log    shim_host.dat    tCAP                 top.wdb  webtalk.log  xsim.jou
ocse.parms  sim.log          terminal.log         tout     xsaet.tcl    xsim.log

</code></pre>

<p>And you can use following command to open the waveform.</p>
<pre><code>xsim top.wdb -gui &amp;
</code></pre>

<p><img alt="waveform" src="../pictures/2-waveform.png" /></p>
<p>On the project scope (hierarchy) panel, the user logic is <code>action_w</code>.</p>
<h2 id="make-fpga-bit-image">Make FPGA bit image</h2>
<p>In above steps, you actually have finished steps of:</p>
<ul>
<li>make snap_config</li>
<li>make model</li>
<li>make sim</li>
</ul>
<p>(These targets are introduced in <a href="../1-prepare-env/#option2-traditional-make-steps">Traditional "make" steps</a>)</p>
<p>Now you can generate FPGA image by</p>
<pre><code>./ocaccel_workflow.py --no_configure --no_make_model --no_run_sim --make_image
</code></pre>

<p>It takes about 2 hours or more. For some big design or bad-timing design, it takes even longer. Check the progress:</p>
<ul>
<li><code>./snap_workflow.make_image.log</code></li>
<li>Or <code>hardware/logs/snap_build.log</code> for more detailed logs.</li>
</ul>
<p>For example, <code>./snap_workflow.make_image.log</code> may tell you:</p>
<pre><code>[BUILD IMAGE.........] start 16:58:57 Sat Sep 14 2019

A complete FPGA bitstream build got kicked off.
This might take more than an hour depending on the machine used
The process may be terminated by pressing &lt;CTRL&gt;-C at any time.
After termination it can be restarted later.

    open framework project                                      16:59:06 Sat Sep 14 2019
    start synthesis         with directive: Default             16:59:25 Sat Sep 14 2019
    start opt_design        with directive: Explore             17:18:58 Sat Sep 14 2019
                            reload opt_design DCP               17:27:19 Sat Sep 14 2019
    start place_design      with directive: Explore             17:28:23 Sat Sep 14 2019
    start phys_opt_design   with directive: Explore             17:42:58 Sat Sep 14 2019
    start route_design      with directive: Explore             18:04:55 Sat Sep 14 2019
    start opt_routed_design with directive: Explore             18:39:01 Sat Sep 14 2019
    generating reports                                          18:57:28 Sat Sep 14 2019
    Timing (WNS)            -11 ps
                            WARNING: TIMING FAILED, but may be OK for lab use
    generating bitstreams   type: user image                    18:58:28 Sat Sep 14 2019
</code></pre>

<p>So you can have an estimation of the progress.</p>
<p>After it's completed, you can find the FPGA bit image files in <code>hardware/build/Images</code>. The file names have the information of build date/time, action name, card type and timing slack (-11ps here).</p>
<pre><code>$ cd hardware/build/Images
$ ls
oc_2019_0914_1657_25G_hls_helloworld_noSDRAM_AD9V3_-11.bit
oc_2019_0914_1657_25G_hls_helloworld_noSDRAM_AD9V3_-11_primary.bin
oc_2019_0914_1657_25G_hls_helloworld_noSDRAM_AD9V3_-11_primary.prm
oc_2019_0914_1657_25G_hls_helloworld_noSDRAM_AD9V3_-11_secondary.bin
oc_2019_0914_1657_25G_hls_helloworld_noSDRAM_AD9V3_-11_secondary.prm

</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A small negative timing slack less than 200ps (set in variable $TIMING_LABLIMIT), is usually acceptable for Lab test, but for product, it's suggested to work out a timing cleaned FPGA image. See <a href="../7-build-image/">Build image</a> for more information.</p>
</div>
<p>Then go to <a href="../8-deploy/">Deploy on Power Server</a> to see how to download the bitstream and run.</p>
<h2 id="summary">Summary</h2>
<p>Now you understand how to run an existing example. You can use the same method to run other examples in <code>actions</code> directory.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../extra.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
