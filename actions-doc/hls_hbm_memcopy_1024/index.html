<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>hls_hbm_memcopy_1024 - OC-Accel Doc</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../extra.css" rel="stylesheet">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">OC-Accel Doc</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../.." class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../../repository/" class="dropdown-item">About the repository</a>
</li>
                                    
<li>
    <a href="../../system_firmware_setup/" class="dropdown-item">System Firmware Setup</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../user-guide/0-steps/" class="dropdown-item">(0) Steps in a glance</a>
</li>
                                    
<li>
    <a href="../../user-guide/1-prepare-env/" class="dropdown-item">(1) Prepare environment</a>
</li>
                                    
<li>
    <a href="../../user-guide/2-run-helloworld/" class="dropdown-item">(2) Run helloworld</a>
</li>
                                    
<li>
    <a href="../../user-guide/3-new-action/" class="dropdown-item">(3) Create a new action</a>
</li>
                                    
<li>
    <a href="../../user-guide/4-hdl-design/" class="dropdown-item">(4) Verilog/VHDL design</a>
</li>
                                    
<li>
    <a href="../../user-guide/5-hls-design/" class="dropdown-item">(5) HLS C++ design</a>
</li>
                                    
<li>
    <a href="../../user-guide/6-co-simulation/" class="dropdown-item">(6) Co-Simulation</a>
</li>
                                    
<li>
    <a href="../../user-guide/7-build-image/" class="dropdown-item">(7) Build image</a>
</li>
                                    
<li>
    <a href="../../user-guide/8-deploy/" class="dropdown-item">(8) Deploy on Power Server</a>
</li>
                                    
<li>
    <a href="../../user-guide/9-migrate/" class="dropdown-item">(9) Migrate from SNAP1/2</a>
</li>
                                    
<li>
    <a href="../../user-guide/10-tips/" class="dropdown-item">(10) Tips</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../hdl_example/" class="dropdown-item">hdl_example</a>
</li>
                                    
<li>
    <a href="../hdl_single_engine/" class="dropdown-item">hdl_single_engine</a>
</li>
                                    
<li>
    <a href="../hls_helloworld_512/" class="dropdown-item">hls_helloworld_512</a>
</li>
                                    
<li>
    <a href="../hls_helloworld_1024/" class="dropdown-item">hls_helloworld_1024</a>
</li>
                                    
<li>
    <a href="../hls_memcopy_512/" class="dropdown-item">hls_memcopy_512</a>
</li>
                                    
<li>
    <a href="../hls_memcopy_1024/" class="dropdown-item">hls_memcopy_1024</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">hls_hbm_memcopy_1024</a>
</li>
                                    
<li>
    <a href="../hls_image_filter/" class="dropdown-item">hls_image_filter</a>
</li>
                                    
<li>
    <a href="../hls_helloworld_python/" class="dropdown-item">hls_helloworld_python</a>
</li>
                                    
<li>
    <a href="../hls_decimal_mult/" class="dropdown-item">hls_decimal_mult</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Deep Dive <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../deep-dive/software-api/" class="dropdown-item">Software API</a>
</li>
                                    
<li>
    <a href="../../deep-dive/registers/" class="dropdown-item">Registers</a>
</li>
                                    
<li>
    <a href="../../deep-dive/hardware-logic/" class="dropdown-item">Hardware Logic</a>
</li>
                                    
<li>
    <a href="../../deep-dive/board-package/" class="dropdown-item">New Board Support</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Appl. Notes <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../apps_notes/Installing_an_OC-AD9V3_on_AC922/" class="dropdown-item">OC-AD9V3 installation in AC922</a>
</li>
                                    
<li>
    <a href="../../apps_notes/Installing_an_OC-AD9H7_on_IC922/" class="dropdown-item">OC-AD9H7 installation in IC922</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../misc/doc-guide/" class="dropdown-item">Document Guide</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../hls_memcopy_1024/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../hls_image_filter/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/OpenCAPI/oc-accel-doc" class="nav-link"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#hls_hbm_memcopy_1024" class="nav-link">hls_hbm_memcopy_1024</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#note-on-hbm-usage-in-oc-accel" class="nav-link">Note on HBM usage in OC-ACCEL:</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#bandwidth-evaluation-test" class="nav-link">Bandwidth Evaluation Test</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#hw_throughput_test" class="nav-link">hw_throughput_test</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="hls_hbm_memcopy_1024">hls_hbm_memcopy_1024</h1>
<p>This is an action using HLS, 1024b and HBM memory found on fpga used on cards like OC-9Hx. 1024b is the optimum configuration as P9 OpenCAPI uses a 1024 bits wide bus.</p>
<p>It can be checked in <em>action/Kconfig</em> file that the ACTION_HALF_WIDTH bloc is not used for this example, so the interface uses the OpenCAPI 1024 bit bus.</p>
<h2 id="note-on-hbm-usage-in-oc-accel">Note on HBM usage in OC-ACCEL:</h2>
<p>OC-9H3 and OC-9H7 cards for example each contain 8GB of HBM reachable through up to 32 AXI buses connected to 256MB HBM memories. 
The test done here exercises only 1 HBM.</p>
<p>As all these HBM can be accessed independently in parallel, this means that the overall throughout of the 8GB of HBM can be multiplied by 32. </p>
<p>The HBM can also be configured in different manners (One 8GB HBM, multiple access to 256MB modules,...).</p>
<p>The default choice in Kconfig menu is 12 HBM memories set in parallel.
Reducing to 1 memory can easily be done by modifying at the same time:</p>
<ul>
<li>in the Kconfig menu</li>
<li>in the hls_hbm_memcopy_1024.cpp code changing the parameter #define HBM_AXI_IF_NB to 1.</li>
</ul>
<h2 id="bandwidth-evaluation-test">Bandwidth Evaluation Test</h2>
<p>This generic test can be also used to evaluate the throughput to/from FPGA and LCL memories (local can be DDR or HBM depending on cards used).</p>
<p>It reports bandwidth of:</p>
<ul>
<li>Host -&gt; FPGA_RAM</li>
<li>FPGA_RAM -&gt; Host</li>
<li>FPGA (HBM -&gt; RAM)</li>
<li>FPGA (RAM -&gt; HBM)</li>
</ul>
<h2 id="hw_throughput_test">hw_throughput_test</h2>
<p>Example on IC922 with a OC-AD9H3 card:</p>
<pre><code>$ cd actions/hls_hbm_memcopy_1024/tests
$ sudo ./hw_throughput_test.sh -dINCR
</code></pre>

<pre><code>+-------------------------------------------------------------------------------+
|            OC-Accel hls_hbm_memcopy_1024 Throughput (MBytes/s)                |
+-------------------------------------------------------------------------------+
       bytes   Host-&gt;FPGA_RAM   FPGA_RAM-&gt;Host   FPGA(HBM-&gt;RAM)   FPGA(RAM-&gt;HBM)
 -------------------------------------------------------------------------------
         512            0.739            0.742            0.741            9.481
        1024           17.965           18.963            1.488            1.482
        2048            2.955            2.934            2.968            3.012
        4096            5.945            5.885            5.902            5.911
        8192           11.924           11.907           11.703          148.945
       16384          292.571          292.571          227.556           23.406
       32768           46.612           47.080           46.217          555.390
       65536          897.753         1110.780         1024.000          101.292
      131072          186.447          185.918          185.918          199.805
      262144          403.298          366.635          359.594         2759.411
      524288         6393.756         5825.422          673.892          682.667
     1048576         1396.240         7231.559         1216.445         1299.351
     2097152        12409.183         8774.695         5475.593         5282.499
     4194304         4832.147         4185.932         2166.479         2075.361
     8388608         4639.717         4269.012         3063.772         4080.062
    16777216        10343.536         9805.503         5027.634         4178.634
    33554432        10485.760        10277.008         5053.378         4919.283
    67108864        13166.346        13560.086         5627.106         5445.822
   134217728        15080.644        16192.270         5969.477         5760.912
   268435456        16460.354        17956.750         6062.776         5929.392
   536870912        17014.893        19000.917
  1073741824        17391.630        19322.677
ok
Test OK
</code></pre>
<p>To get the best results, it may be useful to ensure you have the ocapi link attached to the core where the program is executed. If you have 2 nodes (check with numactl -s), you can try the 4 following combinations:</p>
<pre><code>sudo numactl -m0 -N0 ./oc-accel/actions/hls_hbm_memcopy_1024/tests/hw_throughput_test.sh -d INCR
sudo numactl -m8 -N0 ./oc-accel/actions/hls_hbm_memcopy_1024/tests/hw_throughput_test.sh -d INCR
sudo numactl -m0 -N8 ./oc-accel/actions/hls_hbm_memcopy_1024/tests/hw_throughput_test.sh -d INCR
sudo numactl -m8 -N8 ./oc-accel/actions/hls_hbm_memcopy_1024/tests/hw_throughput_test.sh -d INCR
</code></pre>

<p>Note:</p>
<p>"-m" stands for memory: allocate selected memory  from  nodes </p>
<p>"-N" stands for nodes: execute command on the CPUs of selected nodes</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../extra.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
