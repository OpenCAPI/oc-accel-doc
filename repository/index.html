<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>About the repository - OC-Accel Doc</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">OC-Accel Doc</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="..">Overview</a>
</li>
                                    
<li class="active">
    <a href="./">About the repository</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../user-guide/0-steps/">(0) Steps in a glance</a>
</li>
                                    
<li >
    <a href="../user-guide/1-prepare-env/">(1) Prepare environment</a>
</li>
                                    
<li >
    <a href="../user-guide/2-run-helloworld/">(2) Run helloworld</a>
</li>
                                    
<li >
    <a href="../user-guide/3-new-action/">(3) Create a new action</a>
</li>
                                    
<li >
    <a href="../user-guide/4-hdl-design/">(4) Verilog/VHDL design</a>
</li>
                                    
<li >
    <a href="../user-guide/5-hls-design/">(5) HLS C++ design</a>
</li>
                                    
<li >
    <a href="../user-guide/6-co-simulation/">(6) Co-Simulation</a>
</li>
                                    
<li >
    <a href="../user-guide/7-build-image/">(7) Build image</a>
</li>
                                    
<li >
    <a href="../user-guide/8-deploy/">(8) Deploy on Power Server</a>
</li>
                                    
<li >
    <a href="../user-guide/9-migrate/">(9) Migrate from SNAP1/2</a>
</li>
                                    
<li >
    <a href="../user-guide/10-tips/">(10) Tips</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../actions-doc/hdl_example/">hdl_example</a>
</li>
                                    
<li >
    <a href="../actions-doc/hdl_single_engine/">hdl_single_engine</a>
</li>
                                    
<li >
    <a href="../actions-doc/hls_helloworld/">hls_helloworld</a>
</li>
                                    
<li >
    <a href="../actions-doc/hls_memcopy_1024/">hls_memcopy_1024</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Deep Dive <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../deep-dive/software-api/">Software API</a>
</li>
                                    
<li >
    <a href="../deep-dive/registers/">Registers</a>
</li>
                                    
<li >
    <a href="../deep-dive/hardware-logic/">Hardware Logic</a>
</li>
                                    
<li >
    <a href="../deep-dive/board-package/">New Board Support</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../misc/doc-guide/">Document Guide</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="..">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../user-guide/0-steps/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/OpenCAPI/oc-accel"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#repository-structure">Repository Structure</a></li>
            <li><a href="#sub-directories-in-oc-accel">Sub directories in oc-accel</a></li>
            <li><a href="#sub-directories-in-oc-bip">Sub directories in oc-bip</a></li>
        <li class="main "><a href="#filesets-and-hardware-hierarchy">Filesets and Hardware Hierarchy</a></li>
            <li><a href="#files-used-in-simulation-step">Files used in Simulation Step</a></li>
            <li><a href="#top-hierarchy-in-simulation-step">Top hierarchy in Simulation Step</a></li>
            <li><a href="#files-used-in-implementation-step">Files used in Implementation Step</a></li>
            <li><a href="#top-hierarchy-in-implementation-step">Top hierarchy in Implementation Step</a></li>
            <li><a href="#files-used-in-deployment">Files used in Deployment</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>This page introduces the components and files in OC-Accel. For a step-by-step guidance, please start from <strong>User Guide</strong> <a href="../user-guide/0-steps/">Steps in a glance</a>.</p>
<h1 id="repository-structure">Repository Structure</h1>
<p>The diagram below shows the entire diretory structure of OC-Accel GIT repository. It links to another repository <a href="https://github.com/OpenCAPI/OpenCAPI3.0_Client_RefDesign">OpenCAPI3.0_Client_RefDesign</a> or <code>oc-bip</code> which contains the card specific packages and modules to support OpenCAPI protocol.</p>
<p><img alt="oc-accel-oc-bip" src="../pictures/oc-accel-oc-bip.svg" /></p>
<h2 id="sub-directories-in-oc-accel">Sub directories in oc-accel</h2>
<p>The framework has some facilitating components:</p>
<ul>
<li><strong>scripts</strong>: scripts for development environment. It displays a simple user interaction interface to select the card, the application to run (action), simulator, and other options.</li>
<li><strong>defconfig</strong>: configuration files for Jenkins regression test (users don't need them.)</li>
<li><strong>web-doc</strong>: documentations (this webpage)</li>
</ul>
<p>It has the modules to bridge OpenCAPI protocol:</p>
<ul>
<li><strong>Software</strong>: provides user library to operate OpenCAPI cards like open_device(), attach_action(), etc. It includes header files and some tools.</li>
<li><strong>Hardware</strong>: It has a TLx-to-AXI bridge Verilog design in <code>hdl</code>, the scripts to build a Vivado project and run the process in <code>setup</code>, the simulation scripts in <code>sim</code>, and the link to <code>oc-bip</code>.</li>
</ul>
<p>Then it is the User Application <code>actions</code> directory.</p>
<ul>
<li>OC-Accel has already provided several examples in <strong>actions</strong> directory, including Verilog/VHDL examples and HLS (High Level Synthesis) examples. When a user wants to create a new Acceleration Application, he or she creates a new directory here.</li>
<li>Under <code>actions/&lt;NAME&gt;</code>, use application also have software part <code>sw</code>, hardware part <code>hw</code> and test scripts <code>test</code>.</li>
</ul>
<h2 id="sub-directories-in-oc-bip">Sub directories in oc-bip</h2>
<p><img alt="oc-bip" src="../pictures/oc-bip.svg" /></p>
<p>Any card vendor can add their card package support in <code>oc-bip</code>. The concept is similar to <strong>DSA</strong> (Device Support Archive) or <strong>BSP</strong> (Board Support Package).</p>
<ul>
<li><strong>Board_support_packages</strong>: Card vendor need to create a separate folder for a new device. It includes:<ol>
<li>Constraint files (xdc) to describe the Card pins, flash interface, configurations and so on.</li>
<li>Tcl files to create necessary Vivado IPs.</li>
<li><em>Enprypted</em> Verilog files to use Xilinx high speed serdes IOs.</li>
<li>Verilog files for parameters and FPGA top.</li>
</ol>
</li>
<li><strong>config_subsystem</strong>: Shared common logic for OpenCAPI Config.</li>
<li><strong>scripts</strong>: to pack the entire <code>oc-bip</code> to a Vivado IP (oc_bsp_wrap.xci).</li>
<li><strong>sim</strong>: Top Verilog file for simulation.</li>
<li><strong>Tlx</strong>: OpenCAPI Device transaction layer reference design.</li>
<li><strong>Dlx</strong>: OpenCAPI Device data link layer reference design.</li>
</ul>
<p>For more information, please refer to <a href="../deep-dive/board-package/">New Board Support</a>.</p>
<h1 id="filesets-and-hardware-hierarchy">Filesets and Hardware Hierarchy</h1>
<h2 id="files-used-in-simulation-step">Files used in Simulation Step</h2>
<p><img alt="co-sim" src="../pictures/co-sim.svg" /></p>
<p>In accelerator development, software and hardware co-simulation is a very important step. The simulation doesn't contain module tlx and dlx, but replies on OCSE to emulate the behavior of host. For more information, please refer to <a href="../user-guide/6-co-simulation/">Co-Simulation</a>.</p>
<p><a href="https://github.com/OpenCAPI/ocse">OCSE</a> (OpenCAPI Simulation Engine) is also required. (TODO: update link)</p>
<h2 id="top-hierarchy-in-simulation-step">Top hierarchy in Simulation Step</h2>
<ul>
<li><strong>top.sv</strong> is in <code>oc-bip/sim</code> directory.</li>
<li><strong>oc_cfg</strong> is OpenCAPI Configuration subsystem.</li>
<li><strong>oc_function</strong> is the DUT (Design under Test) in this step.</li>
<li><strong>oc_snap_core</strong> is in <code>hardware/hdl</code></li>
<li>User logic <strong>action_wrapper</strong> will be implemented in <code>actions/&lt;NAME&gt;/hw</code></li>
<li>We use OCSE's DPI-C functions to drive and respond to the bus transactions.
<img alt="sim-top" src="../pictures/sim-top.svg" /></li>
</ul>
<h2 id="files-used-in-implementation-step">Files used in Implementation Step</h2>
<p><img alt="build-bitstream" src="../pictures/build-bitstream.svg" /></p>
<p>After co-simulation passed, it's time to do the <strong>Synthesis</strong> and <strong>Implementation</strong> in Vivado. For more information, please refer to <a href="../user-guide/7-build-image/">User guide: build image</a>.</p>
<h2 id="top-hierarchy-in-implementation-step">Top hierarchy in Implementation Step</h2>
<p>To generate a FPGA bitstream (binary image), the top design file is <code>oc_fpga_top.v</code>.</p>
<ul>
<li><strong>oc_fpga_top</strong> is located in <code>hardware/oc-bip/board_support_packeages/&lt;CARD&gt;/Verilog/framework_top</code></li>
<li><strong>oc_bsp_wrap</strong> includes TLx, Dlx, PHY, Flash subsystem and Card information (VPD). A script <code>create_oc_bsp.tcl</code> will assemble these components to a Vivado IP.</li>
<li><strong>oc_cfg</strong> is OpenCAPI Configuration subsystem.</li>
<li><strong>oc_function</strong> is what we have just simulated and proved that the functions can work correctly.</li>
<li><strong>oc_snap_core</strong> is in <code>hardware/hdl</code></li>
<li>User logic <strong>action_wrapper</strong> will be implemented in <code>actions/&lt;NAME&gt;/hw</code></li>
</ul>
<p><img alt="oc-fpga-top" src="../pictures/oc-fpga-top.svg" /></p>
<h2 id="files-used-in-deployment">Files used in Deployment</h2>
<p><img alt="deploy-and-run" src="../pictures/deploy-and-run.svg" /></p>
<p>When FPGA bit image is generated, use the tool <code>oc-flash-script</code> in <a href="https://github.ibm.com/OC-Enablement/oc-utils/">oc-utils</a> (TODO: update link) to download it from Power9 host server to the FPGA flash. After reboot, the bit image takes effect and you can ask application to call FPGA acceleration, with the help of <code>libosnap</code> and <code>libocxl</code>.</p>
<p><a href="https://github.com/OpenCAPI/libocxl">libocxl</a> need to be installed. Please follow the README file on its homepage.</p>
<p>Application software and libosnap need to be compiled on Power9 host server also. For more information, please refer to <a href="../user-guide/8-deploy/">User-guide: deploy</a>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../extra.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
